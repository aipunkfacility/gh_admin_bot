---
import AdminLayout from '../../layouts/AdminLayout.astro';

const cookies = Astro.cookies;
const ADMIN_PASSWORD = import.meta.env.ADMIN_PASSWORD;

let isAuth = false;
if (ADMIN_PASSWORD) {
    const { getAuthToken } = await import('../../lib/auth');
    const expectedToken = getAuthToken(ADMIN_PASSWORD);
    isAuth = cookies.get('gh_admin_auth')?.value === expectedToken;
}

if (!isAuth) {
    return Astro.redirect('/admin/login');
}

// Управление контентом
const managementItems = [
    { name: 'Посты', slug: 'posts', icon: 'ri-telegram-fill', color: 'from-blue-500 to-indigo-600' },
    { name: 'Экскурсии', slug: 'excursions', icon: 'ri-caravan-fill', color: 'from-orange-500 to-action' },
    { name: 'Транспорт', slug: 'transport-items', icon: 'ri-roadster-fill', color: 'from-brand to-green-800' },
    { name: 'Жилье', slug: 'accommodations', icon: 'ri-hotel-fill', color: 'from-blue-600 to-dark' },
    { name: 'Услуги', slug: 'services', icon: 'ri-customer-service-2-fill', color: 'from-amber-500 to-orange-600' },
];

// Системные настройки
const systemItems = [
    { name: 'Разделы', slug: 'sections', icon: 'ri-layout-grid-fill', color: 'from-purple-500 to-purple-700' },
    { name: 'Настройки сайта', slug: 'site-meta', icon: 'ri-settings-4-fill', color: 'from-slate-600 to-slate-800' },
    { name: 'Настройки бота', slug: 'bot-settings', icon: 'ri-robot-2-fill', color: 'from-cyan-500 to-cyan-700' },
];
---

<AdminLayout title="Дашборд">
    <div class="mb-12">
        <h1 id="greeting" class="text-3xl font-extrabold text-dark tracking-tight mb-2">Добро пожаловать</h1>
        <p class="text-slate-400 font-bold text-xs uppercase tracking-widest" id="currentDate"></p>
    </div>

    {/* CONTENT MANAGEMENT */}
    <div class="mb-12">
        <div class="flex items-center gap-3 mb-6">
            <span class="w-1.5 h-6 bg-action rounded-full"></span>
            <h2 class="text-sm font-black text-slate-400 uppercase tracking-widest">Управление контентом</h2>
        </div>
        
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4">
            
            {/* Telegram Posts */}
            <a href="/admin/posts" class="group bg-white rounded-2xl p-4 border border-slate-200 shadow-sm hover:shadow-xl hover:border-action/30 hover:-translate-y-1 transition-all duration-300 flex items-center gap-4">
                <div class="w-14 h-14 shrink-0 rounded-xl bg-blue-50 text-blue-600 flex items-center justify-center text-3xl group-hover:scale-110 transition-transform duration-300">
                    <i class="ri-telegram-fill"></i>
                </div>
                <div>
                    <h3 class="text-xl font-bold text-dark group-hover:text-blue-600 transition-colors">Посты</h3>
                </div>
            </a>

            {/* Excursions */}
            <a href="/admin/excursions" class="group bg-white rounded-2xl p-4 border border-slate-200 shadow-sm hover:shadow-xl hover:border-action/30 hover:-translate-y-1 transition-all duration-300 flex items-center gap-4">
                 <div class="w-14 h-14 shrink-0 rounded-xl bg-orange-50 text-action flex items-center justify-center text-3xl group-hover:scale-110 transition-transform duration-300">
                    <i class="ri-caravan-fill"></i>
                </div>
                <div>
                    <h3 class="text-xl font-bold text-dark group-hover:text-action transition-colors">Экскурсии</h3>
                </div>
            </a>

            {/* Transport */}
            <a href="/admin/transport-items" class="group bg-white rounded-2xl p-4 border border-slate-200 shadow-sm hover:shadow-xl hover:border-action/30 hover:-translate-y-1 transition-all duration-300 flex items-center gap-4">
                 <div class="w-14 h-14 shrink-0 rounded-xl bg-green-50 text-brand flex items-center justify-center text-3xl group-hover:scale-110 transition-transform duration-300">
                    <i class="ri-roadster-fill"></i>
                </div>
                <div>
                    <h3 class="text-xl font-bold text-dark group-hover:text-brand transition-colors">Транспорт</h3>
                </div>
            </a>

            {/* Accommodation */}
            <a href="/admin/accommodations" class="group bg-white rounded-2xl p-4 border border-slate-200 shadow-sm hover:shadow-xl hover:border-action/30 hover:-translate-y-1 transition-all duration-300 flex items-center gap-4">
                 <div class="w-14 h-14 shrink-0 rounded-xl bg-indigo-50 text-indigo-600 flex items-center justify-center text-3xl group-hover:scale-110 transition-transform duration-300">
                    <i class="ri-hotel-fill"></i>
                </div>
                <div>
                    <h3 class="text-xl font-bold text-dark group-hover:text-indigo-600 transition-colors">Жилье</h3>
                </div>
            </a>

            {/* Services */}
            <a href="/admin/services" class="group bg-white rounded-2xl p-4 border border-slate-200 shadow-sm hover:shadow-xl hover:border-action/30 hover:-translate-y-1 transition-all duration-300 flex items-center gap-4">
                 <div class="w-14 h-14 shrink-0 rounded-xl bg-amber-50 text-amber-600 flex items-center justify-center text-3xl group-hover:scale-110 transition-transform duration-300">
                    <i class="ri-customer-service-2-fill"></i>
                </div>
                <div>
                    <h3 class="text-xl font-bold text-dark group-hover:text-amber-600 transition-colors">Услуги</h3>
                </div>
            </a>

        </div>
    </div>


    {/* SYSTEM SETTINGS */}
    <div class="mb-12">
        <div class="flex items-center gap-3 mb-6">
            <span class="w-1.5 h-6 bg-slate-200 rounded-full"></span>
            <h2 class="text-sm font-black text-slate-400 uppercase tracking-widest">Система</h2>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            
            {/* Sections */}
            <a href="/admin/sections" class="group bg-white rounded-2xl p-4 border border-slate-200 shadow-sm hover:shadow-xl hover:border-purple-500/30 hover:-translate-y-1 transition-all duration-300 flex items-center gap-4">
                <div class="w-12 h-12 shrink-0 rounded-lg bg-purple-50 text-purple-600 flex items-center justify-center text-2xl">
                    <i class="ri-layout-grid-fill"></i>
                </div>
                <div class="flex-1">
                    <h3 class="text-lg font-bold text-dark group-hover:text-purple-600 transition-colors">Разделы</h3>
                </div>
                <div class="w-8 h-8 rounded-full bg-slate-50 flex items-center justify-center text-slate-300 group-hover:bg-purple-600 group-hover:text-white transition-all">
                    <i class="ri-arrow-right-line"></i>
                </div>
            </a>

            {/* Site Meta */}
            <a href="/admin/site-meta" class="group bg-white rounded-2xl p-4 border border-slate-200 shadow-sm hover:shadow-xl hover:border-slate-500/30 hover:-translate-y-1 transition-all duration-300 flex items-center gap-4">
                <div class="w-12 h-12 shrink-0 rounded-lg bg-slate-100 text-slate-600 flex items-center justify-center text-2xl">
                    <i class="ri-settings-4-fill"></i>
                </div>
                <div class="flex-1">
                    <h3 class="text-lg font-bold text-dark group-hover:text-slate-600 transition-colors">Настройки сайта</h3>
                </div>
                <div class="w-8 h-8 rounded-full bg-slate-50 flex items-center justify-center text-slate-300 group-hover:bg-slate-600 group-hover:text-white transition-all">
                    <i class="ri-arrow-right-line"></i>
                </div>
            </a>

            {/* Bot Settings */}
            <a href="/admin/bot-settings" class="group bg-white rounded-2xl p-4 border border-slate-200 shadow-sm hover:shadow-xl hover:border-cyan-500/30 hover:-translate-y-1 transition-all duration-300 flex items-center gap-4">
                <div class="w-12 h-12 shrink-0 rounded-lg bg-cyan-50 text-cyan-600 flex items-center justify-center text-2xl">
                    <i class="ri-robot-2-fill"></i>
                </div>
                <div class="flex-1">
                    <h3 class="text-lg font-bold text-dark group-hover:text-cyan-600 transition-colors">Настройки бота</h3>
                </div>
                <div class="w-8 h-8 rounded-full bg-slate-50 flex items-center justify-center text-slate-300 group-hover:bg-cyan-600 group-hover:text-white transition-all">
                    <i class="ri-arrow-right-line"></i>
                </div>
            </a>

        </div>
    </div>

    <script>
        // Greeting Logic
        const hour = new Date().getHours();
        const greetingEl = document.getElementById('greeting');
        let text = 'Здравствуйте';
        if (hour >= 5 && hour < 12) text = 'Доброе утро';
        else if (hour >= 12 && hour < 18) text = 'Добрый день';
        else if (hour >= 18 && hour < 23) text = 'Добрый вечер';
        
        if (greetingEl) greetingEl.textContent = text + ', Администратор';

        // Date Logic
        const dateEl = document.getElementById('currentDate');
        if (dateEl) {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            // @ts-expect-error - options type mismatch in localedate
            dateEl.textContent = new Date().toLocaleDateString('ru-RU', options);
        }
    </script>
</AdminLayout>
